<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Cursor MCP Plugin</title>
  </head>
  <body>
    <h2>🧠 MCP Plugin</h2>
    <p>선택된 오브젝트를 MCP로 전송하고, MCP로부터 명령을 수신합니다.</p>

    <script>
      // WebSocket 연결
      const socket = new WebSocket("ws://localhost:3055");

      // 연결되자마자 자동 join
      socket.onopen = () => {
        console.log("✅ WebSocket 연결됨");
        socket.send(JSON.stringify({
          type: "join",
          channel: "default"
        }));
      };

      // MCP → 명령 수신
      socket.onmessage = (event) => {
        const message = JSON.parse(event.data);
        console.log("📥 MCP에서 받은 메시지:", message);

        if (message.type === "execute-command") {
          parent.postMessage({ pluginMessage: message }, "*");
        }
      };

      // Figma Plugin → MCP로 메시지 전송
      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;

        // 오브젝트 선택 정보 전송
        if (msg?.type === "selection") {
          console.log("📤 선택 전송:", msg);
          socket.send(JSON.stringify(msg));
        }

        // 실행 시 auto-connect
        if (msg?.type === "auto-connect") {
          console.log("📤 auto-connect → join 전송");
          socket.send(JSON.stringify({
            type: "join",
            channel: "default"
          }));
        }
      };
    </script>
  </body>
</html>
