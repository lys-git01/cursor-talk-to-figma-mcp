<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Cursor MCP Plugin</title>
  </head>
  <body>
    <h2>ğŸ§  MCP Plugin</h2>
    <p>ì„ íƒëœ ì˜¤ë¸Œì íŠ¸ë¥¼ MCPë¡œ ì „ì†¡í•˜ê³ , MCPë¡œë¶€í„° ëª…ë ¹ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤.</p>

    <script>
      // WebSocket ì—°ê²°
      const socket = new WebSocket("ws://localhost:3055");

      // ì—°ê²°ë˜ìë§ˆì ìë™ join
      socket.onopen = () => {
        console.log("âœ… WebSocket ì—°ê²°ë¨");
        socket.send(JSON.stringify({
          type: "join",
          channel: "default"
        }));
      };

      // MCP â†’ ëª…ë ¹ ìˆ˜ì‹ 
      socket.onmessage = (event) => {
        const message = JSON.parse(event.data);
        console.log("ğŸ“¥ MCPì—ì„œ ë°›ì€ ë©”ì‹œì§€:", message);

        if (message.type === "execute-command") {
          parent.postMessage({ pluginMessage: message }, "*");
        }
      };

      // Figma Plugin â†’ MCPë¡œ ë©”ì‹œì§€ ì „ì†¡
      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;

        // ì˜¤ë¸Œì íŠ¸ ì„ íƒ ì •ë³´ ì „ì†¡
        if (msg?.type === "selection") {
          console.log("ğŸ“¤ ì„ íƒ ì „ì†¡:", msg);
          socket.send(JSON.stringify(msg));
        }

        // ì‹¤í–‰ ì‹œ auto-connect
        if (msg?.type === "auto-connect") {
          console.log("ğŸ“¤ auto-connect â†’ join ì „ì†¡");
          socket.send(JSON.stringify({
            type: "join",
            channel: "default"
          }));
        }
      };
    </script>
  </body>
</html>
